# Отчет по лабораторной работе № 6
## по курсу "Объектно-оринетированное программирование"

Студент группы М8О-208Б-23 Федорова Екатерина Васильевна

Работа выполнена 

1. **Тема**: Паттерны проектирования
2. **Цель работы**: Закрепление паттернов SOLID
3. **Задание (вариант №6)**: 
Вы разрабатываете редактор подземелья для новой RPG игры Balagur Fate 3. Ваша задача сделать программу, которая позволит моделировать базовые локации, расставляя на них NPC (non-player characters). Редактор должен позволять делать следующие действия:
- Добавлять новые NPC по разным координатам (типы объектов предопределены заданием): 
a. NPC размещаются в квадрате 0<=x<=500 метров, 0<=y<=500 метров; 
b. У каждого типа объекта помимо координат должно быть уникальное имя.
- Сохранять объекты в файл и загружать из файла
- Печатать перечень объектов на экран (с типом объектов, координатами и именем)
- Запускать боевой режим с указанием дальности, на которой могут сражаться NPC. В боевом режиме NPC начинают сражаться каждый с каждым (если дальность позволяет), проигравший NPC – удаляется. При этом погибнуть могут и оба NPC.

При создании программы обязательно использовать паттерны:
- Какой-нибудь из вариантов Factory для создания NPC и загрузки NPC из файла
- Visitor – для проведения цикла сражения
- Observer – для печати событий о совершенных убийствах. Сделать два класса Observer – для записи в файл “log.txt” и для печати на экран.

Варинт: Медведь, Эльф, Разбойник. Эльфы убивают разбойников. Разбойники убивают разбойников. Медведь убивает эльфов.
4. **Идея, метод, алгоритм решения задачи**: Пользователю предлагается выбрать одно из нескольких действий:

1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход

- `observer.cpp`

Реализует паттерн проектирования "Наблюдатель". Он содержит классы `FileObserver` и `ConsoleObserver`:

`FileObserver`: Класс записывает сообщения в файл. В конструкторе он принимает имя файла, в который будет производиться запись. Метод `Update` открывает файл в режиме добавления, что позволяет сохранять историю сообщений.

`ConsoleObserver`: Этот класс выводит сообщения в консоль. Он обращается к методу Update, который передает сообщение на стандартный вывод.



- `visitor.cpp`

Реализует паттерн проектирования "Посетитель", который позволяет добавлять новые операции для объектов, не изменяя сами объекты.

`ConcreteVisitorBattle`: Класс реализует логику битвы между NPC. Метод `Visit` выполняет проверку на наличие противников в пределах видимости и добавляет их в список убитых, если враг находится в пределах допустимого расстояния. Метод `SeeOpponents` принимает список NPC и задает их как противников.

- `factory.cpp`

Реализует паттерн проектирования "Фабрика", который отвечает за создание объектов.

`ConcreteNPCFactory`: Эта фабрика создает NPC в зависимости от заданного типа. Метод `CreateNPC` принимает строку с типом и создает соответствующий объект NPC. Метод `LoadNPC` загружает данные о NPC из строки и передает их методу `CreateNPC` для создания нового экземпляра.

- `npc.cpp`

Реализуется класс NPC.

Конструктор `NPC(const std::string& name, int x, int y)` принимает имя и координаты (x, y) персонажа, инициализируя соответствующие поля данных. Методы `GetName`, `GetX` и `GetY` позволяют получить информацию о персонаже.

- `bear.cpp`

Реализует класс `Bear`, который является подклассом NPC.

Конструктор: `Bear::Bear(const std::string& name, int x, int y)` вызывает конструктор базового класса NPC с передачей имени и координат. Метод `GetType` возвращает строку "Bear", которая указывает на тип персонажа. Метод `accept` принимает объект `Visitor` и вызывает его метод `Visit`, передавая текущий объект типа `Bear`. Этот метод позволяет паттерну проектирования "Посетитель" работать с объектами.

- `robber.cpp` и `elf.cpp`

Аналогичны `bear.cpp` и определяют классы `Robber` и `Elf` соответственно.

- `game.cpp`

Управляет объектом игры.

Метод `NotifyObservers` уведомляет всех наблюдателей об изменении состояния, передавая сообщение. Метод `WipeLogFile` очищает файл лога, который используется для хранения информации о событиях игры. Конструктор `Game` инициализирует объект игры и вызывает `WipeLogFile`, чтобы подготовить лог-файл к записи. Метод `AddNPC` добавляет нового NPC в игру, проверяя допустимость координат. Метод `SaveToFile` сохраняет текущее состояние NPC в файл. Метод `LoadFromFile` загружает NPC из заданного файла, очищая при этом все текущие NPC. Метод `PrintNPC` печатает в консоль информацию о всех NPC, находящихся в игре. Метод `RunBattle` запускает битву среди NPC, используя паттерн "Посетитель", чтобы определить, кто из них был убит. Удаляет убитых NPC из списка. Метод `AddObserver` добавляет нового наблюдателя в список. Метод `CountOfNPC` возвращает текущее количество NPC.

6. **Протокол**: 
Запуск тестов:
```
moscow@moscow:~/Рабочий стол/OOP_2k/build$ make test
Running tests...
Test project /home/moscow/Рабочий стол/OOP_2k/build
    Start 1: lab6_test
1/2 Test #1: lab6_test ........................   Passed    0.00 sec
    Start 2: lab6_test+
2/2 Test #2: lab6_test+ .......................   Passed    0.00 sec

100% tests passed, 0 tests failed out of 2

Total Test time (real) =   0.01 sec
```

Отдельные запуски вручную:
```
moscow@moscow:~/Рабочий стол/OOP_2k/build$ ./lab6/OOP_6
Инициализация игры...Готово!

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 1
Выберете, кого хотите добавить.
1. Медведь
2. Эльф
3. Разбойник
Ваш выбор: 1
Введите координаты вида х, y: 100 100
NPC добавлен.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 1
Выберете, кого хотите добавить.
1. Медведь
2. Эльф
3. Разбойник
Ваш выбор: 2
Введите координаты вида х, y: 200 200
NPC добавлен.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 1
Выберете, кого хотите добавить.
1. Медведь
2. Эльф
3. Разбойник
Ваш выбор: 3
Введите координаты вида х, y: 300 300
NPC добавлен.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 1
Выберете, кого хотите добавить.
1. Медведь
2. Эльф
3. Разбойник
Ваш выбор: 3
Введите координаты вида х, y: 310 310
NPC добавлен.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 1
Выберете, кого хотите добавить.
1. Медведь
2. Эльф
3. Разбойник
Ваш выбор: 7
Введите координаты вида х, y: 30 50
Неверный выбор.
NPC добавлен.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 8
Неверный выбор. Пожалуйста, попробуйте снова.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 5
Bear Bear_0 at (100, 100)
Elf Elf_1 at (200, 200)
Robber Robber_2 at (300, 300)
Robber Robber_3 at (310, 310)

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 4
Игра сохранена.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 2
Игра загружена.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 5
Bear Bear_0 at (100, 100)
Elf Elf_1 at (200, 200)
Robber Robber_2 at (300, 300)
Robber Robber_3 at (310, 310)

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 3
Введите диапазон: 150
Robber Robber_3 has been killed
Robber Robber_2 has been killed
Elf Elf_1 has been killed
Bear Bear_0 at (100, 100)
Конец батлов.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 5
Bear Bear_0 at (100, 100)

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 4
Игра сохранена.

--- Меню ---
1. Добавление NPCs
2. Загрузка из файла
3. Пуск битв
4. Сохранение игры
5. Вывод всех NPC
0. Выход
Ваш выбор: 0
Выход из игры. До свидания!
```

7. **Замечания автора** по существу работы: -.
8. **Выводы**:  Вот. Во-о-о-от!! Вот эту лабораторную работу я понимаю, выполнять её было полным удовольствием! Наконец я снова чувствовала себя комфортно, быстро схватывала материал, так ещё и реализовывала кусочек игры, что увлекало в процесс сильнее. Истинное наслаждение, я в восторге, я довольна, люблю эту лабораторную работу и считаю её выполненной. Очень надеюсь, что следующая будет похожа -- смогу снова порезвиться с паттернами. Неудобство было только одно: VSCode отказывался видеть заголовочные файлы и помечал мне всё-всё ошибками. Но да Бог с ним, ведь программа готова и отлажена.